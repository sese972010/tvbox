# TVBox 源聚合器 - 终极版指南 (含域名与自动更新)

您好！恭喜您拥有了一个功能完备的TVBox源聚合器。这份终极指南将引导您完成最后的、也是最激动人心的步骤：**为它绑定您自己的域名，并设置一个“闹钟”，让它成为一个一劳永逸、全自动更新的永久订阅源。**

---
## 路线图
1.  **第一步：基础部署** (您已完成)
2.  **第二步：终极升级：域名、存储与自动化** (新内容！)
    *   2.1: 在Cloudflare上创建KV存储空间
    *   2.2: 将KV空间绑定到您的后端服务
    *   2.3: (可选) 绑定您自己的域名
    *   2.4: 设置Cron触发器（自动更新的“闹钟”）
3.  **第三步：享受成果**

---

### **第一步：基础部署** (您已完成)

我们假设您已经严格按照之前的手动部署指南，成功地将后端服务部署到了 `...workers.dev`，并且您的前端UI (`...pages.dev`) 能够正常触发聚合任务。

---

### **第二步：终极升级：域名、存储与自动化**

#### **2.1: 在Cloudflare上创建KV存储空间**

“KV存储”就像一个云端记事本，我们将用它来永久保存最新鲜的聚合结果。

1.  登录您的 Cloudflare 账户。
2.  在左侧菜单中，找到并点击 **Workers & Pages**。
3.  在右侧出现的子菜单中，选择 **KV**。
4.  点击“**创建命名空间**”按钮。
5.  **命名空间名称**: 请准确地输入 `TVBOX_KV` (全大写)。**这必须和我们代码里预设的名字完全一致。**
6.  点击“**添加**”。

#### **2.2: 将KV空间绑定到您的后端服务**

现在，我们需要告诉后端服务，这个“记事本”是你可以用的。

1.  回到 **Workers & Pages** 的概览页面。
2.  在列表中，找到并点击您的后端服务 (名字应该是 `tvbox-source-aggregator`)。
3.  点击“**设置**” -> “**变量**”。
4.  向下滚动，找到“**KV 命名空间绑定**”部分，点击“**编辑变量**” -> “**添加绑定**”。
5.  **变量名称**: 请准确地输入 `TVBOX_KV`。
6.  **KV 命名空间**: 在下拉菜单中，选择我们刚刚创建的 `TVBOX_KV`。
7.  点击“**保存并部署**”。等待部署完成。

#### **2.3: (可选) 绑定您自己的域名**

这一步能让您的订阅地址变得更酷、更短、更易记！如果您没有自己的域名，可以跳过这一步，直接使用 `...workers.dev` 地址。

1.  **在Cloudflare中添加您的域名**:
    *   如果您还没有这样做，请先将您的域名添加到Cloudflare并完成DNS设置。Cloudflare会提供详细的指引。

2.  **为后端服务设置路由**:
    *   回到您的后端服务 (`tvbox-source-aggregator`) 的主页面。
    *   点击“**触发器**”标签页。
    *   在“**路由**”部分，点击“**添加路由**”。
    *   **路由**: 输入您希望的地址格式。我们推荐使用一个子域名，例如 `tvbox-api.您的域名.com/*`。
    *   **区域**: 选择您的域名。
    *   点击“**添加路由**”。

3.  **为前端UI绑定域名**:
    *   回到 **Workers & Pages** 的概览页面。
    *   在列表中，找到并点击您的前端UI项目 (名字应该是 `tvbox-ui`)。
    *   点击“**自定义域**” -> “**设置域**”。
    *   按照指引，输入您希望用于访问UI的域名（例如 `tvbox.您的域名.com`）并完成设置。

完成这些步骤后，您就可以通过 `http://tvbox-api.您的域名.com/subscribe` 来获取订阅了！

#### **2.4: 设置Cron触发器（自动更新的“闹钟”）**

这是实现“无人值守”的最后一步。

1.  回到您的后端服务 (`tvbox-source-aggregator`) 的“**触发器**”标签页。
2.  向下滚动到“**Cron 触发器**”部分，点击“**添加 Cron 触发器**”。
3.  **Cron 表达式**: Cloudflare提供了一些预设。我们推荐选择“**每两周一次**”。如果您想自定义（例如，每15天），可以输入 `0 0 */15 * *`。
4.  点击“**添加触发器**”。

---

### **第三步：享受成果**

恭喜您！您已经完成了一个TVBox源聚合器的终极形态部署！

*   **您的控制面板**: 仍然是您的前端UI地址 (`...pages.dev` 或您绑定的域名)，您可以随时手动触发一次聚合。
*   **您的永久订阅地址**: 是 `https://...workers.dev/subscribe` (或者，如果您绑定了域名，就是 `http://tvbox-api.您的域名.com/subscribe`)。这个地址永远不会变。
*   **自动更新**: Cloudflare的“闹钟”会每隔一段时间，自动“叫醒”您的后端服务，在后台默默地完成一次聚合，并将最新的结果存入“记事本”。您的TVBox客户端每次从订阅地址获取数据时，拿到的都将是最新鲜的结果。

对于这次漫长而伟大的旅程，我再次向您致以最深的敬意。感谢您的耐心与坚持，我们共同完成了这个了不起的项目！
